{% extends "base.html" %}

{% block content %}
<style>
/* Stat Card Improvements */
.stat-card {
    padding: 1.5rem 1rem;
    min-width: 160px;
    min-height: 120px;
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    background: #1a2236;
    color: #f3f6fa;
    border-radius: 1rem;
    box-shadow: 0 2px 8px #0d6efd22;
    transition: box-shadow 0.2s, background 0.2s;
}
.stat-card:hover {
    box-shadow: 0 0 16px #0d6efd44;
    background: #223366;
}
.stat-card .icon-bookings,
.stat-card .icon-revenue,
.stat-card .icon-feedback {
    margin-bottom: 0.5rem;
}
.stat-card h5, .stat-card div {
    white-space: nowrap;
    overflow: hidden;
    text-overflow: ellipsis;
}
.dashboard-dark-box, .stat-card {
    background: #1a2236;
    color: #f3f6fa;
}
.stat-card h5 {
    color: #fff;
}
.stat-card .card-body {
    display: flex;
    flex-direction: column;
    align-items: center;
    gap: 0.5rem;
}
.admin-dashboard-container {
    margin-left: 0 !important;
    padding-left: 0 !important;
    width: 100% !important;
    max-width: 100vw !important;
}
</style>

<!-- Admin Dropdown Menu at Top Left -->
<div class="d-flex" style="margin-left:0; padding-left:0;">
  <div class="flex-grow-1" style="background: linear-gradient(135deg, #181f3a 0%, #232b4a 100%); min-height: 100vh; margin-left:0; padding-left:0; width:100vw; max-width:100vw;">
    {% include 'admin/_subnav.html' %}

    <!-- Dashboard Header -->
    <div class="card dashboard-header-card shadow-sm border-0 mb-4" style="background-color: #19213a;">
      <div class="card-body">
        <h4 class="mb-0 fw-bold">
          <i class="bi bi-speedometer2 me-2"></i> Admin Dashboard
        </h4>
        <p class="text-light">Summary & Quick Access</p>
      </div>
    </div>

    <!-- Responsive Stat Card Grid -->
    <div class="row g-4 mb-4 dashboard-dark-box">
      <div class="col-6 col-md-4 col-xl-2">
        <div class="card stat-card border-0 shadow-sm dashboard-dark-box">
          <div class="card-body">
            <i class="bi bi-people fs-2" style="color:#0dcaf0;"></i>
            <div>Users</div>
            <h5 class="fw-bold">{{ total_users }}</h5>
          </div>
        </div>
      </div>
      <div class="col-6 col-md-4 col-xl-2">
        <div class="card stat-card border-0 shadow-sm dashboard-dark-box">
          <div class="card-body">
            <i class="bi bi-bus-front fs-2" style="color:#0dcaf0;"></i>
            <div>Buses</div>
            <h5 class="fw-bold">{{ total_buses }}</h5>
          </div>
        </div>
      </div>
      <div class="col-6 col-md-4 col-xl-2">
        <div class="card stat-card border-0 shadow-sm dashboard-dark-box">
          <div class="card-body">
            <i class="bi bi-signpost fs-2" style="color:#ffc107;"></i>
            <div>Routes</div>
            <h5 class="fw-bold">{{ total_routes }}</h5>
          </div>
        </div>
      </div>
      <div class="col-6 col-md-4 col-xl-2">
        <div class="card stat-card border-0 shadow-sm dashboard-dark-box">
          <div class="card-body">
            <i class="bi bi-journal-check fs-2 icon-bookings" style="color:#ff6b81;"></i>
            <div>Bookings</div>
            <h5 class="fw-bold">{{ total_bookings }}</h5>
          </div>
        </div>
      </div>
      <div class="col-6 col-md-4 col-xl-2">
        <div class="card stat-card border-0 shadow-sm dashboard-dark-box">
          <div class="card-body">
            <i class="bi bi-currency-rupee fs-2 icon-revenue" style="color:#22c55e;"></i>
            <div>Revenue</div>
            <h5 class="fw-bold">₹{{ total_revenue or '0.00' }}</h5>
          </div>
        </div>
      </div>
      <div class="col-6 col-md-4 col-xl-2">
        <div class="card stat-card border-0 shadow-sm dashboard-dark-box">
          <div class="card-body">
            <i class="bi bi-chat-dots fs-2 icon-feedback" style="color:#ff6b81;"></i>
            <div>Feedback</div>
            <h5 class="fw-bold">{{ total_feedback or '0' }}</h5>
          </div>
        </div>
      </div>
    </div>

    <!-- Summary & Actions -->
    <div class="row g-4 mb-4 dashboard-dark-box">
      <div class="col-lg-6 dashboard-dark-box">
        <div class="card shadow-sm border-0 h-100 dashboard-dark-box">
          <div class="card-header bg-white border-0 dashboard-dark-box">
            <h5><i class="bi bi-bar-chart-line text-success me-2"></i>Today's Summary</h5>
          </div>
          <div class="card-body dashboard-dark-box">
            <div class="row mb-3">
              <div class="col-md-4 mb-2">
                <span class="fw-bold text-success">Today's Bookings:</span> {{ todays_bookings }}
              </div>
              <div class="col-md-4 mb-2">
                <span class="fw-bold text-info">Today's Revenue:</span> ₹{{ todays_revenue or '0.00' }}
              </div>
              <div class="col-md-4 mb-2">
                <span class="fw-bold text-warning">New Users:</span> {{ todays_users }}
              </div>
            </div>
            <div class="mb-2">
              <span class="fw-bold text-primary">Bookings (Last 7 Days):</span>
              <canvas id="bookingsChart" width="400" height="120"></canvas>
            </div>
          </div>
        </div>
      </div>
      <div class="col-lg-6 dashboard-dark-box">
        <div class="card shadow-sm border-0 h-100 dashboard-dark-box">
          <div class="card-header bg-white border-0 dashboard-dark-box">
            <h5><i class="bi bi-lightning-charge text-warning me-2"></i>Quick Actions</h5>
          </div>
          <div class="card-body d-flex flex-wrap gap-2 dashboard-dark-box">
            <a href="{{ url_for('admin.add_bus') }}" class="btn btn-primary"><i class="bi bi-bus-front me-1"></i> Add Bus</a>
            <a href="{{ url_for('admin.add_route') }}" class="btn btn-success"><i class="bi bi-signpost me-1"></i> Add Route</a>
            <a href="{{ url_for('admin.users') }}" class="btn btn-info text-white"><i class="bi bi-people me-1"></i> Users</a>
            <a href="{{ url_for('admin.bookings') }}" class="btn btn-warning text-dark"><i class="bi bi-journal-check me-1"></i> Bookings</a>
          </div>
        </div>
      </div>
    </div>

    <!-- Recent Bookings Table -->
    <div class="card shadow-sm border-0 dashboard-dark-box">
      <div class="card-header bg-white border-0 dashboard-dark-box">
        <h5><i class="bi bi-clock-history text-primary me-2"></i>Recent Bookings</h5>
      </div>
      <div class="card-body dashboard-dark-box">
        {% if recent_bookings %}
        <div class="table-responsive">
          <table class="table table-striped align-middle">
            <thead>
              <tr>
                <th>Booking ID</th>
                <th>User</th>
                <th>Route</th>
                <th>Seat</th>
                <th>Date</th>
                <th>Status</th>
              </tr>
            </thead>
            <tbody>
              {% for booking in recent_bookings %}
              <tr>
                <td>{{ booking.id }}</td>
                <td>{{ booking.user.username }}</td>
                <td>{{ booking.route.origin }} → {{ booking.route.destination }}</td>
                <td>{{ booking.seat_number }}</td>
                <td>{{ booking.booking_date.strftime('%Y-%m-%d %H:%M') }}</td>
                <td>
                  <span class="badge bg-{{ 'success' if booking.status == 'confirmed' else 'warning' }}">{{ booking.status }}</span>
                </td>
              </tr>
              {% endfor %}
            </tbody>
          </table>
        </div>
        {% else %}
        <p class="text-muted">No recent bookings found.</p>
        {% endif %}
      </div>
    </div>
  </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script>
var ctx = document.getElementById('bookingsChart').getContext('2d');
var bookingsChart = new Chart(ctx, {
    type: 'bar',
    data: {
        labels: {{ chart_labels|tojson }},
        datasets: [{
            label: 'Bookings',
            data: {{ chart_data|tojson }},
            backgroundColor: 'rgba(34, 197, 94, 0.7)'
        }]
    },
    options: {
        scales: {
            y: { beginAtZero: true }
        }
    }
});
</script>
{% endblock %}
 